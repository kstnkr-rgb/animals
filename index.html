<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–£–≥–∞–¥–∞–π –∂–∏–≤–æ—Ç–Ω–æ–µ</title>
<style>
  :root {
    --bg:#111;--panel:#1b1b1b;--accent:#06f;--ok:#8f8;--cell:#ddd;
  }
  html,body {
    height:100%;margin:0;
    background:var(--bg);color:#eee;
    font-family:Arial,Helvetica,sans-serif;
    display:flex;align-items:flex-start;justify-content:center;
    padding:10px;
  }
  .app {
    width:100%;max-width:480px;
    display:flex;flex-direction:column;gap:10px;align-items:center;
  }
  .header {
    display:flex;gap:6px;align-items:center;
    justify-content:space-between;width:100%;
  }
  h1 {
    margin:0;font-size:16px;
  }
  button {
    background:#2b6;border:0;padding:8px 10px;border-radius:8px;
    cursor:pointer;color:#012;font-size:14px;touch-action:manipulation;
  }
  .stage {
    background:var(--panel);padding:12px;border-radius:12px;
    box-shadow:0 6px 18px rgba(0,0,0,.6);
    width:100%;display:flex;flex-direction:column;align-items:center;gap:12px;
  }
  .preview {
    width:100%;max-width:320px;aspect-ratio:1;
    background:#ddd;border-radius:8px;display:flex;align-items:center;justify-content:center;
    overflow:hidden;
  }
  .preview img {width:100%;height:100%;object-fit:contain;}
  .slots {display:flex;gap:6px;min-height:56px;align-items:center;justify-content:center;flex-wrap:wrap;}
  .slot {
    width:48px;height:48px;border-radius:6px;border:2px dashed rgba(255,255,255,.08);
    background:transparent;display:flex;align-items:center;justify-content:center;
    font-size:22px;color:#222;
  }
  .slot.occupied{border-style:solid;background:#fff;}
  .pool {
    display:flex;gap:6px;flex-wrap:wrap;justify-content:center;padding:6px;
    max-width:100%;
  }
  .tile {
    width:48px;height:48px;border-radius:6px;background:#fff;display:flex;
    align-items:center;justify-content:center;font-size:22px;color:#111;
    cursor:grab;user-select:none;border:1px solid rgba(0,0,0,.08);
    touch-action:none; /* –≤–∞–∂–Ω–æ –¥–ª—è touch-drag */
  }
  .tile.dragging {opacity:.5;position:fixed;z-index:999;pointer-events:none;}
  .footer {display:flex;gap:8px;align-items:center;justify-content:center;width:100%;}
  .message {color:#bfb;text-align:center;font-weight:600;font-size:15px;}
  @keyframes flashGreen {
    0%{background:var(--bg)}10%{background:var(--ok)}
    40%{background:var(--bg)}70%{background:var(--ok)}100%{background:var(--bg)}
  }
</style>
</head>
<body>
  <div class="app" id="app">
    <div class="header">
      <h1>–£–≥–∞–¥–∞–π –∂–∏–≤–æ—Ç–Ω–æ–µ</h1>
      <div class="controls">
        <button id="prevBtn">‚óÄÔ∏è</button>
        <button id="nextBtn">‚ñ∂Ô∏è</button>
        <button id="restartBtn">üîÅ</button>
      </div>
    </div>

    <div class="stage" id="stage">
      <div class="preview" id="preview"></div>
      <div class="playarea">
        <div class="slots" id="slots"></div>
        <div class="pool" id="pool"></div>
      </div>
    </div>

    <div class="footer">
      <div class="message" id="message">–°–æ–±–µ—Ä–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ, –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—è –±—É–∫–≤—ã.</div>
    </div>
  </div>

<script>
const animals = [
  {file:"Group.png",name:"–ª–æ—Å—å"},
  {file:"Group-1.png",name:"–≤–æ–ª–∫"},
  {file:"Group-2.png",name:"–ª–∏—Å–∞"},
  {file:"Group-3.png",name:"–º–µ–¥–≤–µ–¥—å"},
  {file:"Group-4.png",name:"–æ–ª–µ–Ω—å"},
  {file:"Group-5.png",name:"–∫–∞–±–∞–Ω"},
  {file:"Group-6.png",name:"–µ–∂"},
  {file:"Group-7.png",name:"–±–æ–±–µ—Ä"},
  {file:"Group-8.png",name:"–∑–∞—è—Ü"},
  {file:"Group-9.png",name:"–±–µ–ª–∫–∞"}
];

const preview=document.getElementById('preview');
const slotsWrap=document.getElementById('slots');
const pool=document.getElementById('pool');
const message=document.getElementById('message');
const stage=document.getElementById('stage');

let index=0,tileCounter=0,tilesMap=new Map();

function normalizeName(name){return name.trim().toLowerCase();}
function splitLetters(word){return Array.from(word);}
function shuffle(a){a=a.slice();for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
function clearContainers(){slotsWrap.innerHTML='';pool.innerHTML='';tilesMap.clear();}

function renderAnimal(i){
  clearContainers();
  const a=animals[i],letters=splitLetters(normalizeName(a.name));
  preview.innerHTML=`<img src="image/${a.file}" alt="${a.name}" onerror="this.parentNode.textContent='(–Ω–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)'" />`;
  letters.forEach((ch,idx)=>{
    const s=document.createElement('div');
    s.className='slot';s.dataset.index=idx;s.dataset.expected=ch;
    s.addEventListener('dragover',e=>e.preventDefault());
    s.addEventListener('drop',onDrop);
    slotsWrap.appendChild(s);
  });
  shuffle(letters).forEach(ch=>pool.appendChild(createTile(ch)));
  message.textContent='–°–æ–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–æ: '+a.name.length+' –±—É–∫–≤';
}

function createTile(ch){
  const t=document.createElement('div');
  const id='tile-'+(tileCounter++);
  t.id=id;t.className='tile';t.textContent=ch;t.dataset.letter=ch;t.draggable=true;
  tilesMap.set(id,t);
  t.addEventListener('dragstart',onDragStart);
  t.addEventListener('dragend',onDragEnd);
  t.addEventListener('touchstart',onTouchStart,{passive:false});
  return t;
}

let dragId=null,dragTile=null;
function onDragStart(e){dragId=e.target.id;e.target.classList.add('dragging');}
function onDragEnd(e){e.target.classList.remove('dragging');dragId=null;checkWinCondition();}

function onDrop(e){
  e.preventDefault();
  const dest=e.currentTarget,tileId=e.dataTransfer?.getData('text/plain')||dragId;
  if(!tileId)return;
  const tile=tilesMap.get(tileId),existing=dest.querySelector('.tile');
  if(!tile)return;
  const parent=tile.parentElement;
  if(existing&&parent){
    const ph1=document.createElement('div'),ph2=document.createElement('div');
    parent.replaceChild(ph1,tile);dest.replaceChild(ph2,existing);
    parent.replaceChild(existing,ph1);dest.replaceChild(tile,ph2);
  }else{
    parent?.removeChild(tile);dest.appendChild(tile);
  }
  updateSlots();checkWinCondition();
}

pool.addEventListener('dragover',e=>e.preventDefault());
pool.addEventListener('drop',e=>{
  e.preventDefault();
  const tileId=e.dataTransfer?.getData('text/plain')||dragId;
  if(!tileId)return;
  const tile=tilesMap.get(tileId);
  tile?.parentElement?.removeChild(tile);
  pool.appendChild(tile);
  updateSlots();checkWinCondition();
});

pool.addEventListener('click',e=>{
  const t=e.target.closest('.tile');if(!t)return;
  const empty=[...slotsWrap.children].find(s=>!s.querySelector('.tile'));
  if(empty){t.parentElement.removeChild(t);empty.appendChild(t);updateSlots();checkWinCondition();}
});

function updateSlots(){
  [...slotsWrap.children].forEach(s=>s.classList.toggle('occupied',!!s.querySelector('.tile')));
}

function checkWinCondition(){
  const s=[...slotsWrap.children];
  if(s.some(el=>!el.querySelector('.tile')))return;
  const ok=s.every(el=>{
    const t=el.querySelector('.tile');return t&&t.dataset.letter===el.dataset.expected;
  });
  if(ok)onWin();
}

function onWin(){
  stage.style.animation='flashGreen 700ms ease-in-out';
  setTimeout(()=>stage.style.animation='',800);
  message.textContent='–ü—Ä–∞–≤–∏–ª—å–Ω–æ!';
  setTimeout(()=>nextAnimal(),800);
}

function nextAnimal(){
  index++;
  if(index>=animals.length){message.textContent='–í—Å–µ –∂–∏–≤–æ—Ç–Ω—ã–µ –ø—Ä–æ–π–¥–µ–Ω—ã!';return;}
  renderAnimal(index);
}
function prevAnimal(){if(index>0){index--;renderAnimal(index);}}
function startOver(){index=0;tileCounter=0;renderAnimal(index);}

document.getElementById('nextBtn').onclick=nextAnimal;
document.getElementById('prevBtn').onclick=prevAnimal;
document.getElementById('restartBtn').onclick=startOver;
startOver();

/* === Touch drag logic === */
let touchStartX=0,touchStartY=0;

function onTouchStart(e){
  const t=e.target.closest('.tile');if(!t)return;
  e.preventDefault();
  dragTile=t;
  const touch=e.touches[0];
  touchStartX=touch.clientX;touchStartY=touch.clientY;
  const rect=t.getBoundingClientRect();
  t.classList.add('dragging');
  t.style.left=rect.left+'px';
  t.style.top=rect.top+'px';
  document.addEventListener('touchmove',onTouchMove,{passive:false});
  document.addEventListener('touchend',onTouchEnd);
}

function onTouchMove(e){
  if(!dragTile)return;
  const touch=e.touches[0];
  e.preventDefault();
  dragTile.style.left=(touch.clientX-24)+'px';
  dragTile.style.top=(touch.clientY-24)+'px';
}

function onTouchEnd(e){
  if(!dragTile)return;
  const touch=e.changedTouches[0];
  const x=touch.clientX,y=touch.clientY;
  dragTile.classList.remove('dragging');
  dragTile.style.left='';dragTile.style.top='';
  const dropTarget=document.elementFromPoint(x,y);
  const slot=dropTarget?.closest('.slot');
  if(slot){
    slot.appendChild(dragTile);
  }else{
    pool.appendChild(dragTile);
  }
  dragTile=null;
  document.removeEventListener('touchmove',onTouchMove);
  document.removeEventListener('touchend',onTouchEnd);
  updateSlots();checkWinCondition();
}
</script>
</body>
</html>
